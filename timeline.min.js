$(document).ready(function(){var b={black:{mark_color:"gray",plot_stroke:"black",plot_fill:"rgba(0,0,0,0.05)",time_fill:"black",time_shadow:"white",range_stroke:"rgba(31,119,180,0.8)",range_fill:"rgba(31,119,180,0.2)",tracking_stroke:"rgba(31,119,180,1)",tracking_fill:"rgba(31,119,180,0.3)",current_line:"black"},white:{mark_color:"gray",plot_stroke:"white",plot_fill:"rgba(255,255,255,0.3)",time_fill:"white",range_stroke:"rgba(255,255,255,0.7)",range_fill:"rgba(255,255,255,0.1)",tracking_stroke:"rgba(255,255,255,1)",tracking_fill:"rgba(255,255,255,0.3)",current_line:"white"}};var a=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var c=function(f){var e=f.toString();while(e.length<2){e="0"+e}return e};var d=function(e){return a[e.getMonth()]+" "+e.getDate()+", "+e.getFullYear()+" "+c(e.getHours())+":"+c(e.getMinutes())};$(".pkuvis-timeline").each(function(){var u=this;var n=100;var e=false;var i=b.black;var k={track_range:true};var j=false;$(this).children("span").hide();$(this).children("span.set-height").each(function(){n=$(this).html()});$(this).children("span.set-colorscheme").each(function(){i=b[$(this).html()]});$(this).children("span.enable-yticks").each(function(){e=true});$(this).children("span.disable-track-range").each(function(){k.track_range=false});$(this).children("span.window-width").each(function(){j=true});$(this).css("height",n+"px");$(this).css("cursor","crosshair");$(this).append('<canvas class="graph"></canvas>');var f=$(this).children(".graph")[0];if(j){f.width=$(window).width()}else{f.width=$(u).width()}f.height=n;var r=f.getContext("2d");this.timeline_data=undefined;var q=function(w){var y=u.timeline_data;if(y==undefined){return 0}var z=f.width;var B=y.start;var A=y.end;return(w-10)/(z-20)*(A-B)+B};var m=function(x){var w=u.timeline_data;if(w==undefined){return 0}var y=f.width;var A=w.start;var z=w.end;return(x-A)/(z-A)*(y-20)+10};var l=false;var p=0;var o=0;var g=undefined;var v=function(x,w){if(u[x]!=undefined){u[x](w)}};var s="left";var h=false;this.redraw=function(ab,L){g=[ab,L];r.clearRect(0,0,f.width,f.height);r.font="12px Helvetica";var M=u.timeline_data;if(M==undefined){return}var E=M.start;var D=M.end;var V=new Date(E*1000);V.setHours(12);V.setMinutes(0);V.setSeconds(0);var B=V.getTime()/1000-3600*24;var O=f.width;var U=f.height-12;var S=1;var ac=0;var I=function(ae){return(ae-E)/(D-E)*(O-20)+10};var W=function(ae){return(ae-10)/(O-20)*(D-E)+E};if(ab!=undefined){var x=function(ae){return(Math.exp(ae)-Math.exp(-ae))/(Math.exp(ae)+Math.exp(-ae))};var R=30;if(L!=undefined){R=L*L*30}if(R>60){R=60}var w=function(ae){return ae+R*x(ae/5)*Math.exp(-ae*ae/100/R)};if(h){w=function(ae){return ae+R*ae/5}}I=function(af){var ae=(af-E)/(D-E)*(O-20)+10;ae=ab+3*w((ae-ab)/3);return ae}}var F=function(ae){return U-ae*S};var N=(D-E)/((O-20)/2);var A=[[1,10],[5,6],[10,6],[20,3],[60,6],[360,4],[720,14],[1440,7],[1440*7,4]];var K=1440*7*60,Q=4;for(var T in A){if(A[T][0]*60>N){K=A[T][0]*60;Q=A[T][1];break}}if(s=="left"){if(ab>O*0.6666){s="right"}}else{if(ab<O*0.3333){s="left"}}var P=function(al,ao){r.strokeStyle=i.mark_color;var af=0;tt=B;while(tt<D){if(tt>=E){r.beginPath();var an=I(tt);r.moveTo(an,U);r.lineTo(an,U+(af%Q==0?10:4));r.stroke()}tt+=K;af++}r.strokeStyle=i.plot_stroke;r.fillStyle=i.plot_fill;r.beginPath();r.moveTo(I(E),U);for(var ah in al){var at=al[ah];var ar=ah/(al.length-1)*(D-E)+E;r.lineTo(I(ar),F(at))}r.lineTo(I(D),U);r.closePath();r.fill();r.stroke();if(e){if(s=="left"){r.textAlign="left"}else{r.textAlign="right"}r.fillStyle=i.time_fill;r.strokeStyle=i.mark_color;var aj=ac/S;var ae=Math.floor(Math.log(aj)/Math.log(10));var aq=Math.pow(10,ae)/10;var ag=F(aq)-F(0);var ai=[0.1,0.2,0.5,1,2,5,10,20,50,100];var am=1;while(Math.abs(ag)<12&&am<ai.length){aq=Math.pow(10,ae)*ai[am];ag=F(aq)-F(0);am++}var ap=aq;while(ap<=aj){var ak=F(ap);if(ab!=undefined){if(s=="left"){r.beginPath();r.moveTo(ab-3,ak);r.lineTo(ab+3,ak);r.stroke();r.fillText(ap.toPrecision(2),ab+5,ak+3)}else{r.beginPath();r.moveTo(ab-3,ak);r.lineTo(ab+3,ak);r.stroke();r.fillText(ap.toPrecision(2),ab-5,ak+3)}}ap+=aq}}};if(M.values!=undefined){S=(U-12)/M.scale;ac=(U-12);P(M.values,M.density)}else{var z=0;for(var T in M.lines){var Y=M.lines[T];var ad=M["scale"+Y.suffix];var H=M["values"+Y.suffix];var y=(f.height-12)/M.lines.length;U=y*(z+1);S=(y-13)/ad;ac=y-13;P(H);z++}}if(u.custom_draw!=undefined){r.save();u.custom_draw(r,{tmap:I,width:f.width,height:f.height});r.restore()}r.fillStyle=i.range_fill;r.strokeStyle=i.range_stroke;if(u.range_t0!=undefined&&u.range_t1!=undefined){if((u.range_t1-u.range_t0)/(D-E)<0.7){var Z=I(u.range_t0);var X=I(u.range_t1);r.fillRect(Z,0,X-Z,n);r.strokeRect(Z,0,X-Z,n)}}r.fillStyle=i.tracking_fill;r.strokeStyle=i.tracking_stroke;if(l&&p!=o){var Z=I(p);var X=I(o);r.fillRect(Z,0,X-Z,n);r.strokeRect(Z,0,X-Z,n)}if(ab!=undefined){r.textAlign="center";var G=W(ab);var J=d(new Date(G*1000));var C=r.measureText(J).width;var aa=ab;if(ab-C/2<10){aa=10+C/2}if(ab+C/2>O-10){aa=O-10-C/2}if(i.time_shadow!=undefined){r.fillStyle=i.time_shadow;r.fillText(J,aa,13)}r.fillStyle=i.time_fill;r.fillText(J,aa,12)}if(ab!=undefined){r.beginPath();r.strokeStyle=i.current_line;r.moveTo(ab,14);r.lineTo(ab,n);r.stroke()}};var t=function(){if(g==undefined){u.redraw()}else{u.redraw(g[0],g[1])}};u.safe_redraw=t;this.reloadData=function(w){if(w!=undefined){if(w.start!=undefined&&w.end!=undefined){u.timeline_data=w}else{u.timeline_data=undefined}}else{u.timeline_data=undefined}t()};this.setRange=function(x,w){u.range_t0=x;u.range_t1=w;t()};this.setFocusTime=function(w){u.redraw(m(w),0.5)};$(f).mousemove(function(w){w.offsetX=w.pageX-$(f).offset().left;w.offsetY=w.pageY-$(f).offset().top;o=q(w.offsetX);u.redraw(w.offsetX,w.offsetY/n);u.mouse_t=q(w.offsetX);v("onmousetchanged",undefined)});$(f).mouseout(function(){u.redraw();u.mouse_t=undefined;v("onmousetchanged",undefined)});$(f).dblclick(function(){h=!h;t()});$(f).mousedown(function(w){w.offsetX=w.pageX-$(f).offset().left;w.offsetY=w.pageY-$(f).offset().top;l=true;p=q(w.offsetX);o=p;u.redraw(w.offsetX,w.offsetY/n)});$(window).mouseup(function(x){if(o<p){var w=p;p=o;o=w}if(l){if(k.track_range){if(p==o){u.range_t0=undefined;u.range_t1=undefined}else{u.range_t0=p;u.range_t1=o}v("onrangechanged",undefined)}l=false}t()});$(window).resize(function(){f.width=$(u).width();u.redraw()});t();this.timeline_export=function(){return f.toDataURL("image/png")};this.format_date=d})});